<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Primer - Component Demos</title>
  
  <!-- External Libraries -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/venn.js@0.2.20/build/venn.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- App Styles (shared with main app) -->
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/editor.css">
  
  <!-- Demo Page Specific Styles -->
  <style>
    /* Override body styles from main.css to allow scrolling on standalone page */
    html, body {
      height: auto !important;
      min-height: 100vh;
      overflow: visible !important;
    }
    
    body {
      overflow-y: auto !important;
      display: block !important;
    }

    /* Ensure logo is constrained (in case main.css doesn't load) */
    .logo-img {
      height: 24px !important;
      width: auto !important;
      max-width: 150px;
    }

    /* Fallback navbar styles */
    .top-navbar {
      height: 48px;
      height: var(--navbar-height, 48px);
    }

    /* Layout with sidebar below navbar */
    .demo-content-wrapper {
      display: flex;
      min-height: calc(100vh - 48px); /* Fallback if --navbar-height not available */
      min-height: calc(100vh - var(--navbar-height, 48px));
    }

    /* Demo Sidebar */
    .demo-sidebar {
      width: 220px;
      background: var(--bg-secondary, #ffffff);
      border-right: 1px solid var(--border-color, #d8dde3);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      height: calc(100vh - 48px);
      height: calc(100vh - var(--navbar-height, 48px));
      position: sticky;
      top: 48px;
      top: var(--navbar-height, 48px);
      overflow-y: auto;
      padding-top: var(--space-lg, 12px);
    }

    .demo-sidebar .nav-section {
      padding: 0 var(--space-md);
    }

    .demo-sidebar .nav-section-title {
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      padding: var(--space-sm) var(--space-md);
      margin-top: var(--space-md);
    }

    .demo-sidebar .nav-links {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .demo-sidebar .nav-links li {
      margin: 0;
    }

    .demo-sidebar .nav-links .nav-link {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding: var(--space-sm) var(--space-md);
      color: var(--text-secondary);
      text-decoration: none;
      font-size: var(--text-sm);
      border-radius: var(--border-radius);
      transition: background 0.15s, color 0.15s;
    }

    .demo-sidebar .nav-links .nav-link:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .demo-sidebar .nav-links .nav-link.active {
      background: var(--bg-tertiary);
      color: var(--accent-primary);
    }

    .demo-sidebar .nav-links .nav-link .nav-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    /* Main Content */
    .demo-main {
      flex: 1;
      padding: var(--space-2xl);
      overflow-y: auto;
      max-width: 1200px;
    }

    .demo-main .page-intro {
      margin-bottom: var(--space-2xl);
    }

    .demo-main .page-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: var(--space-sm);
    }

    .demo-main .page-description {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      max-width: 700px;
    }

    /* Component Section */
    .component-section {
      margin-bottom: var(--space-2xl);
    }

    .section-title {
      font-size: var(--text-lg);
      font-weight: 600;
      margin-bottom: var(--space-sm);
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .section-title::before {
      content: '';
      width: 3px;
      height: 18px;
      background: var(--accent-primary);
      border-radius: 2px;
    }

    .section-description {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      margin-bottom: var(--space-lg);
    }

    .demo-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--space-lg);
      overflow: hidden;
    }

    .demo-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--space-lg);
    }

    /* Sparkline Demo */
    .sparkline-demo {
      display: flex;
      align-items: center;
      gap: var(--space-lg);
      flex-wrap: wrap;
    }

    .sparkline-item {
      display: flex;
      align-items: center;
      gap: var(--space-md);
    }

    .sparkline-label {
      font-size: var(--text-sm);
      color: var(--text-secondary);
    }

    /* Code Block */
    .code-block {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: var(--space-lg);
      overflow-x: auto;
      margin-top: var(--space-lg);
    }

    .code-block pre {
      font-family: var(--font-mono);
      font-size: var(--text-xs);
      line-height: 1.5;
      color: var(--text-secondary);
      margin: 0;
    }

    .code-block .key {
      color: var(--accent-primary);
    }

    .code-block .string {
      color: #a5d6a7;
    }

    .code-block .number {
      color: #ffcc80;
    }

    .code-block .comment {
      color: #6a737d;
      font-style: italic;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .demo-content-wrapper {
        flex-direction: column;
      }

      .demo-sidebar {
        width: 100%;
        height: auto;
        position: relative;
        top: 0;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }

      .demo-main {
        padding: var(--space-lg);
      }

      .demo-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="top-navbar">
    <div class="navbar-left">
      <a href="index.html#/dashboard" class="logo">
        <img src="img/logo.png" alt="Primer" class="logo-img">
      </a>
      
      <div class="navbar-links">
        <a href="index.html#/dashboard" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
            <rect x="1" y="1" width="6" height="6" rx="1"/>
            <rect x="9" y="1" width="6" height="6" rx="1"/>
            <rect x="1" y="9" width="6" height="6" rx="1"/>
            <rect x="9" y="9" width="6" height="6" rx="1"/>
          </svg>
          <span>Dashboard</span>
        </a>
        <a href="index.html#/monitors" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
            <rect x="1" y="2" width="14" height="10" rx="1"/>
            <path d="M5 14h6M8 12v2"/>
            <path d="M4 6h2M4 8h3M10 5l2 2-2 2"/>
          </svg>
          <span>Monitors</span>
        </a>
        <a href="index.html#/workspaces" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
            <rect x="1" y="1" width="14" height="14" rx="1"/>
            <path d="M1 5h14"/>
            <path d="M5 5v10"/>
          </svg>
          <span>Workspaces</span>
        </a>
        <a href="index.html#/ai-briefing" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
            <circle cx="8" cy="8" r="6"/>
            <path d="M8 5v3l2 1"/>
            <circle cx="8" cy="8" r="1.5" fill="var(--text-secondary)"/>
            <path d="M3 3l1.5 1.5M13 3l-1.5 1.5M3 13l1.5-1.5M13 13l-1.5-1.5"/>
          </svg>
          <span>AI Briefing</span>
        </a>
        <a href="index.html#/search" class="nav-link">
          <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
            <circle cx="7" cy="7" r="4.5"/>
            <path d="M10.5 10.5L14 14"/>
          </svg>
          <span>Search</span>
        </a>
      </div>
    </div>
    
    <!-- User Avatar with Tools Dropdown -->
    <div class="navbar-right">
      <!-- Data Dropdown -->
      <div class="nav-dropdown data-dropdown">
        <button class="nav-dropdown-trigger">
          <span>Data</span>
          <svg class="dropdown-arrow" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
            <path d="M4 6l4 4 4-4"/>
          </svg>
        </button>
        <div class="nav-dropdown-menu">
          <a href="index.html#/narratives" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <path d="M2 2h12v12H2z" rx="1"/>
              <path d="M4 5h8M4 8h8M4 11h5"/>
            </svg>
            <span>Narratives</span>
          </a>
          <a href="index.html#/factions" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <circle cx="8" cy="5" r="2.5"/>
              <circle cx="4" cy="11" r="2"/>
              <circle cx="12" cy="11" r="2"/>
              <path d="M6 6.5L4.5 9M10 6.5l1.5 2.5"/>
            </svg>
            <span>Factions</span>
          </a>
          <a href="index.html#/locations" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <path d="M8 1C5.2 1 3 3.2 3 6c0 4 5 9 5 9s5-5 5-9c0-2.8-2.2-5-5-5z"/>
              <circle cx="8" cy="6" r="2"/>
            </svg>
            <span>Locations</span>
          </a>
          <a href="index.html#/events" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="2" y="3" width="12" height="11" rx="1"/>
              <path d="M2 6h12M5 1v3M11 1v3"/>
            </svg>
            <span>Events</span>
          </a>
          <a href="index.html#/entities" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <circle cx="8" cy="4" r="2.5"/>
              <path d="M3 14c0-3 2.2-5 5-5s5 2 5 5"/>
            </svg>
            <span>People & Orgs</span>
          </a>
        </div>
      </div>
      
      <div class="nav-dropdown avatar-dropdown">
        <button class="avatar-trigger">
          <span class="avatar-initials">JD</span>
        </button>
        <div class="nav-dropdown-menu avatar-menu">
          <div class="avatar-menu-header">
            <span class="avatar-name">Jane Doe</span>
            <span class="avatar-email">jane.doe@primer.ai</span>
          </div>
          <div class="avatar-menu-divider"></div>
          <a href="index.html#/editor" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <path d="M11 2l3 3-9 9H2v-3l9-9z"/>
            </svg>
            <span>Data Editor</span>
          </a>
          <a href="data-model.html" class="nav-link">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <ellipse cx="8" cy="4" rx="5" ry="2"/>
              <path d="M3 4v8c0 1.1 2.2 2 5 2s5-.9 5-2V4"/>
              <path d="M3 8c0 1.1 2.2 2 5 2s5-.9 5-2"/>
            </svg>
            <span>Data Model</span>
          </a>
          <a href="component-demos.html" class="nav-link active">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="1" y="1" width="5" height="5" rx="1"/>
              <rect x="10" y="1" width="5" height="5" rx="1"/>
              <rect x="1" y="10" width="5" height="5" rx="1"/>
              <rect x="10" y="10" width="5" height="5" rx="1"/>
            </svg>
            <span>Component Demos</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

  <div class="demo-content-wrapper">
    <nav class="demo-sidebar">
      <div class="nav-section">
        <span class="nav-section-title">Charts</span>
        <ul class="nav-links">
          <li><a href="#sparkline" class="nav-link" data-target="sparkline">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <polyline points="1 12 4 8 7 10 11 4 15 6"/>
            </svg> Sparkline
          </a></li>
          <li><a href="#stacked-area" class="nav-link" data-target="stacked-area">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <path d="M1 14V6l4-2 4 3 6-4v11H1z"/>
              <path d="M1 14V9l4-1 4 2 6-3v7H1z" opacity="0.5"/>
            </svg> Stacked Area
          </a></li>
          <li><a href="#sentiment" class="nav-link" data-target="sentiment">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="1" y="3" width="8" height="2" rx="0.5"/>
              <rect x="1" y="7" width="12" height="2" rx="0.5"/>
              <rect x="1" y="11" width="5" height="2" rx="0.5"/>
            </svg> Sentiment
          </a></li>
          <li><a href="#venn" class="nav-link" data-target="venn">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <circle cx="6" cy="8" r="4"/>
              <circle cx="10" cy="8" r="4"/>
            </svg> Venn Diagram
          </a></li>
        </ul>
      </div>

      <div class="nav-section">
        <span class="nav-section-title">Timeline</span>
        <ul class="nav-links">
          <li><a href="#timeline" class="nav-link" data-target="timeline">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <line x1="1" y1="8" x2="15" y2="8"/>
              <circle cx="4" cy="8" r="2"/>
              <circle cx="9" cy="8" r="2"/>
              <circle cx="13" cy="8" r="1.5"/>
            </svg> Timeline
          </a></li>
          <li><a href="#timeline-volume-composite" class="nav-link" data-target="timeline-volume-composite">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <path d="M1 10V4l4 2 4-3 6 4v6H1z"/>
              <line x1="1" y1="13" x2="15" y2="13"/>
              <circle cx="5" cy="13" r="1"/>
              <circle cx="11" cy="13" r="1"/>
            </svg> Timeline + Volume
          </a></li>
        </ul>
      </div>

      <div class="nav-section">
        <span class="nav-section-title">Spatial</span>
        <ul class="nav-links">
          <li><a href="#network" class="nav-link" data-target="network">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <circle cx="8" cy="4" r="2"/>
              <circle cx="4" cy="12" r="2"/>
              <circle cx="12" cy="12" r="2"/>
              <line x1="8" y1="6" x2="5" y2="10"/>
              <line x1="8" y1="6" x2="11" y2="10"/>
              <line x1="6" y1="12" x2="10" y2="12"/>
            </svg> Network Graph
          </a></li>
          <li><a href="#map" class="nav-link" data-target="map">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <path d="M8 1C5.2 1 3 3.2 3 6c0 4 5 9 5 9s5-5 5-9c0-2.8-2.2-5-5-5z"/>
              <circle cx="8" cy="6" r="2"/>
            </svg> Map View
          </a></li>
        </ul>
      </div>

      <div class="nav-section">
        <span class="nav-section-title">Lists</span>
        <ul class="nav-links">
          <li><a href="#faction-cards" class="nav-link" data-target="faction-cards">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="1" y="2" width="6" height="5" rx="1"/>
              <rect x="9" y="2" width="6" height="5" rx="1"/>
              <rect x="1" y="9" width="6" height="5" rx="1"/>
              <rect x="9" y="9" width="6" height="5" rx="1"/>
            </svg> Faction Cards
          </a></li>
          <li><a href="#narrative-list" class="nav-link" data-target="narrative-list">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="1" y="2" width="14" height="3" rx="0.5"/>
              <rect x="1" y="6.5" width="14" height="3" rx="0.5"/>
              <rect x="1" y="11" width="14" height="3" rx="0.5"/>
            </svg> Narrative List
          </a></li>
          <li><a href="#subnarrative-list" class="nav-link" data-target="subnarrative-list">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="1" y="2" width="14" height="2.5" rx="0.5"/>
              <rect x="3" y="6" width="12" height="2.5" rx="0.5"/>
              <rect x="3" y="10" width="12" height="2.5" rx="0.5"/>
            </svg> Theme List
          </a></li>
          <li><a href="#document-list" class="nav-link" data-target="document-list">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="2" y="1" width="10" height="14" rx="1"/>
              <path d="M4 4h6M4 7h6M4 10h4"/>
              <path d="M12 4l2 2v9a1 1 0 01-1 1H5"/>
            </svg> Document List
          </a></li>
        </ul>
      </div>

      <div class="nav-section">
        <span class="nav-section-title">Filters</span>
        <ul class="nav-links">
          <li><a href="#time-range-filter" class="nav-link" data-target="time-range-filter">
            <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="var(--text-secondary)" stroke-width="1">
              <rect x="1" y="10" width="2" height="4"/>
              <rect x="4" y="7" width="2" height="7"/>
              <rect x="7" y="4" width="2" height="10"/>
              <rect x="10" y="6" width="2" height="8"/>
              <rect x="13" y="8" width="2" height="6"/>
              <path d="M1 2h14" stroke-dasharray="2 1"/>
            </svg> Time Range Filter
          </a></li>
        </ul>
      </div>
    </nav>

    <main class="demo-main">
    <section class="page-intro">
      <h1 class="page-title">Component Library</h1>
      <p class="page-description">
        Interactive demos of all visualization components. Click a component in the sidebar to jump to its demo.
      </p>
    </section>

    <!-- Sparkline -->
    <section id="sparkline" class="component-section">
      <h2 class="section-title">Sparkline</h2>
      <p class="section-description">Mini trend visualization for inline display. Shows data trends in a compact format.</p>
      <div class="demo-container">
        <div class="sparkline-demo">
          <div class="sparkline-item">
            <span class="sparkline-label">Upward trend</span>
            <div id="sparkline-up"></div>
          </div>
          <div class="sparkline-item">
            <span class="sparkline-label">Downward trend</span>
            <div id="sparkline-down"></div>
          </div>
          <div class="sparkline-item">
            <span class="sparkline-label">Volatile</span>
            <div id="sparkline-volatile"></div>
          </div>
          <div class="sparkline-item">
            <span class="sparkline-label">With area fill</span>
            <div id="sparkline-area"></div>
          </div>
        </div>
        <div class="code-block">
          <pre><span class="key">const</span> sparkline = <span class="key">new</span> Sparkline(<span class="string">'container'</span>, {
  width: <span class="number">100</span>,
  height: <span class="number">30</span>,
  color: <span class="string">'var(--accent-primary)'</span>,
  showDot: <span class="number">true</span>,
  showArea: <span class="number">false</span>
});
sparkline.update([<span class="number">10</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">18</span>, <span class="number">25</span>, <span class="number">22</span>, <span class="number">30</span>]);</pre>
        </div>
      </div>
    </section>

    <!-- Network Graph -->
    <section id="network" class="component-section">
      <h2 class="section-title">Network Graph</h2>
      <p class="section-description">Force-directed network visualization for people and organizations. Drag nodes to rearrange.</p>
      <div class="demo-container">
        <div id="network-graph" style="height: 400px;"></div>
        <div class="code-block">
          <pre><span class="key">const</span> network = <span class="key">new</span> NetworkGraph(<span class="string">'container'</span>, {
  height: <span class="number">400</span>,
  nodeRadius: <span class="number">20</span>,
  linkDistance: <span class="number">120</span>,
  onNodeClick: (node) => console.log(node)
});
network.update({ nodes: [...], links: [...] });</pre>
        </div>
      </div>
    </section>

    <!-- Stacked Area Chart -->
    <section id="stacked-area" class="component-section">
      <h2 class="section-title">Stacked Area Chart</h2>
      <p class="section-description">Volume over time by faction visualization. Shows cumulative activity across multiple groups.</p>
      <div class="demo-container">
        <div id="stacked-area-chart"></div>
        <div class="code-block">
          <pre><span class="key">const</span> chart = <span class="key">new</span> StackedAreaChart(<span class="string">'container'</span>, {
  height: <span class="number">280</span>
});
chart.update({
  dates: [<span class="string">'2025-01-01'</span>, <span class="string">'2025-01-02'</span>, ...],
  series: [[<span class="number">10</span>, <span class="number">20</span>, ...], [<span class="number">15</span>, <span class="number">25</span>, ...]],
  factions: [{ id: <span class="string">'f1'</span>, name: <span class="string">'Faction A'</span>, color: <span class="string">'#ef4444'</span> }]
});</pre>
        </div>
      </div>
    </section>

    <!-- Sentiment Chart -->
    <section id="sentiment" class="component-section">
      <h2 class="section-title">Sentiment Chart</h2>
      <p class="section-description">Horizontal bar chart showing sentiment by faction. Visualizes positive, neutral, and negative stances.</p>
      <div class="demo-container">
        <div id="sentiment-chart"></div>
        <div class="code-block">
          <pre><span class="key">const</span> chart = <span class="key">new</span> SentimentChart(<span class="string">'container'</span>, {
  height: <span class="number">200</span>,
  barHeight: <span class="number">28</span>,
  onFactionClick: (faction) => console.log(faction)
});
chart.update({
  factions: [
    { name: <span class="string">'State Actors'</span>, sentiment: <span class="number">-0.73</span>, color: <span class="string">'#ef4444'</span> },
    { name: <span class="string">'Media Outlets'</span>, sentiment: <span class="number">0.14</span>, color: <span class="string">'#3b82f6'</span> }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Venn Diagram -->
    <section id="venn" class="component-section">
      <h2 class="section-title">Venn Diagram</h2>
      <p class="section-description">Faction overlap visualization showing relationships between groups.</p>
      <div class="demo-container">
        <div id="venn-diagram" style="height: 350px;"></div>
        <div class="code-block">
          <pre><span class="key">const</span> venn = <span class="key">new</span> VennDiagram(<span class="string">'container'</span>, {
  height: <span class="number">350</span>,
  onFactionClick: (faction) => console.log(faction)
});
venn.update({
  sets: [
    { id: <span class="string">'a'</span>, name: <span class="string">'Group A'</span>, size: <span class="number">1000</span>, color: <span class="string">'#ef4444'</span> },
    { id: <span class="string">'b'</span>, name: <span class="string">'Group B'</span>, size: <span class="number">800</span>, color: <span class="string">'#3b82f6'</span> }
  ],
  overlaps: [{ factionIds: [<span class="string">'a'</span>, <span class="string">'b'</span>], overlapSize: <span class="number">200</span> }]
});</pre>
        </div>
      </div>
    </section>

    <!-- Timeline -->
    <section id="timeline" class="component-section">
      <h2 class="section-title">Timeline</h2>
      <p class="section-description">Event timeline visualization showing chronological progression of activities.</p>
      <div class="demo-container">
        <div id="timeline-chart"></div>
        <div class="code-block">
          <pre><span class="key">const</span> timeline = <span class="key">new</span> Timeline(<span class="string">'container'</span>, {
  height: <span class="number">280</span>,
  onEventClick: (event) => console.log(event)
});
timeline.update({
  events: [
    { id: <span class="string">'1'</span>, text: <span class="string">'Campaign Launch'</span>, date: <span class="string">'2025-01-15T10:00:00Z'</span> },
    { id: <span class="string">'2'</span>, text: <span class="string">'Viral Spread'</span>, date: <span class="string">'2025-01-18T14:30:00Z'</span> }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Timeline Volume Composite -->
    <section id="timeline-volume-composite" class="component-section">
      <h2 class="section-title">Timeline + Volume Composite</h2>
      <p class="section-description">Combined visualization showing volume over time with event markers. Correlate mention spikes with specific events. Toggle between faction and source views. Synchronized zoom and cross-highlighting between charts.</p>
      <div class="demo-container">
        <div id="timeline-volume-composite-chart" style="position: relative;"></div>
        <div class="code-block">
          <pre><span class="key">const</span> composite = <span class="key">new</span> TimelineVolumeComposite(<span class="string">'container'</span>, {
  height: <span class="number">450</span>,
  volumeHeight: <span class="number">180</span>,
  timelineHeight: <span class="number">180</span>,
  showViewToggle: <span class="number">true</span>,  <span class="comment">// Enable faction/source toggle</span>
  onEventClick: (event) => console.log(event)
});
composite.update({
  volumeData: {  <span class="comment">// Volume by faction</span>
    dates: [<span class="string">'2025-01-10'</span>, <span class="string">'2025-01-11'</span>, ...],
    series: [[<span class="number">100</span>, <span class="number">150</span>, ...], [<span class="number">80</span>, <span class="number">120</span>, ...]],
    factions: [{ id: <span class="string">'f1'</span>, name: <span class="string">'State Actors'</span>, color: <span class="string">'#ef4444'</span> }]
  },
  sourceData: {  <span class="comment">// Volume by source (enables toggle)</span>
    dates: [<span class="string">'2025-01-10'</span>, <span class="string">'2025-01-11'</span>, ...],
    series: [[<span class="number">80</span>, <span class="number">120</span>, ...], [<span class="number">60</span>, <span class="number">90</span>, ...]],
    sources: [{ id: <span class="string">'s1'</span>, name: <span class="string">'Twitter'</span>, color: <span class="string">'#000'</span> }]
  },
  events: [
    { id: <span class="string">'1'</span>, text: <span class="string">'Initial article'</span>, date: <span class="string">'2025-01-10T08:00:00Z'</span> },
    { id: <span class="string">'2'</span>, text: <span class="string">'Viral spread'</span>, date: <span class="string">'2025-01-12T14:30:00Z'</span> }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Map View -->
    <section id="map" class="component-section">
      <h2 class="section-title">Map View</h2>
      <p class="section-description">Leaflet map component for location visualization with custom markers.</p>
      <div class="demo-container">
        <div id="map-view" style="height: 400px;"></div>
        <div class="code-block">
          <pre><span class="key">const</span> map = <span class="key">new</span> MapView(<span class="string">'container'</span>, {
  height: <span class="number">400</span>,
  defaultCenter: [<span class="number">48.8566</span>, <span class="number">2.3522</span>],
  defaultZoom: <span class="number">4</span>,
  onMarkerClick: (location) => console.log(location)
});
map.update({
  locations: [
    { name: <span class="string">'Paris'</span>, coordinates: { lat: <span class="number">48.8566</span>, lng: <span class="number">2.3522</span> } }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Faction Cards -->
    <section id="faction-cards" class="component-section">
      <h2 class="section-title">Faction Cards</h2>
      <p class="section-description">Display factions as clickable cards for quick selection and filtering.</p>
      <div class="demo-container">
        <div id="faction-cards-demo"></div>
        <div class="code-block">
          <pre><span class="key">const</span> cards = <span class="key">new</span> FactionCards(<span class="string">'container'</span>, {
  showCount: <span class="number">true</span>,
  onFactionClick: (faction) => console.log(faction)
});
cards.update({
  factions: [
    { id: <span class="string">'1'</span>, name: <span class="string">'State Actors'</span>, color: <span class="string">'#ef4444'</span>, memberCount: <span class="number">1250</span> }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Narrative List -->
    <section id="narrative-list" class="component-section">
      <h2 class="section-title">Narrative List</h2>
      <p class="section-description">List of narratives with sparklines, status indicators, and expandable sub-narratives (themes). Click the tree icon to expand nested themes.</p>
      <div class="demo-container">
        <div id="narrative-list-demo"></div>
        <div class="code-block">
          <pre><span class="key">const</span> list = <span class="key">new</span> NarrativeList(<span class="string">'container'</span>, {
  maxItems: <span class="number">10</span>,
  showSentiment: <span class="number">true</span>,
  showStatus: <span class="number">true</span>,
  showSparkline: <span class="number">true</span>,
  showVolume: <span class="number">true</span>,
  showSubNarratives: <span class="number">true</span>,      <span class="comment">// Enable expandable themes</span>
  maxSubNarratives: <span class="number">5</span>,           <span class="comment">// Max themes shown when expanded</span>
  defaultShowDescription: <span class="number">false</span>, <span class="comment">// Show descriptions by default</span>
  onNarrativeClick: (narrative) => console.log(narrative)
});
list.update({
  narratives: [
    { 
      id: <span class="string">'1'</span>, 
      text: <span class="string">'Election fraud claims'</span>, 
      sentiment: <span class="number">-0.68</span>, 
      status: <span class="string">'new'</span>,
      factionMentions: { f1: { volume: <span class="number">12500</span> } },
      volumeOverTime: [...]
    }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Theme List (SubNarrativeList) -->
    <section id="subnarrative-list" class="component-section">
      <h2 class="section-title">Theme List</h2>
      <p class="section-description">List of themes (sub-narratives) with sentiment badges and sparklines. Themes are more specific messaging patterns within a broader narrative.</p>
      <div class="demo-container">
        <div id="subnarrative-list-demo"></div>
        <div class="code-block">
          <pre><span class="key">const</span> list = <span class="key">new</span> SubNarrativeList(<span class="string">'container'</span>, {
  maxItems: <span class="number">10</span>,
  showSparkline: <span class="number">true</span>,
  defaultShowDescription: <span class="number">false</span>,
  onSubNarrativeClick: (theme) => console.log(theme)
});
list.update({
  subNarratives: [
    { 
      id: <span class="string">'1'</span>, 
      text: <span class="string">'Voting machines are compromised'</span>, 
      sentiment: <span class="number">-0.72</span>,
      description: <span class="string">'Claims about vulnerabilities in voting software'</span>,
      factionMentions: { f1: { volume: <span class="number">5200</span> } },
      volumeOverTime: [...]
    }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Document List -->
    <section id="document-list" class="component-section">
      <h2 class="section-title">Document List</h2>
      <p class="section-description">List of source documents with publication info, source indicators, and external links. Documents link to original sources.</p>
      <div class="demo-container">
        <div id="document-list-demo"></div>
        <div class="code-block">
          <pre><span class="key">const</span> list = <span class="key">new</span> DocumentList(<span class="string">'container'</span>, {
  maxItems: <span class="number">10</span>,
  showExcerpt: <span class="number">true</span>,
  showSource: <span class="number">true</span>,
  showDate: <span class="number">true</span>,
  onDocumentClick: (doc) => console.log(doc)
});
list.update({
  documents: [
    { 
      id: <span class="string">'1'</span>, 
      title: <span class="string">'Breaking: Major policy announcement'</span>,
      url: <span class="string">'https://example.com/article'</span>,
      sourceId: <span class="string">'s1'</span>,
      publishedDate: <span class="string">'2025-01-15T10:30:00Z'</span>,
      excerpt: <span class="string">'Summary of the article content...'</span>
    }
  ]
});</pre>
        </div>
      </div>
    </section>

    <!-- Time Range Filter -->
    <section id="time-range-filter" class="component-section">
      <h2 class="section-title">Time Range Filter</h2>
      <p class="section-description">Histogram with brush selection for filtering data by time range. Drag to select a range, or click and drag the selection to move it.</p>
      <div class="demo-container">
        <div style="display: flex; align-items: center; gap: var(--space-lg); margin-bottom: var(--space-md);">
          <div id="time-range-filter-demo" style="flex: 1; max-width: 400px; height: 48px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--border-radius);"></div>
          <span id="time-range-label-demo" class="time-range-label" style="font-size: var(--text-xs); color: var(--text-muted);">All Time</span>
          <button id="clear-time-filter-demo" class="btn btn-small">Clear</button>
        </div>
        <div class="code-block">
          <pre><span class="key">const</span> filter = <span class="key">new</span> TimeRangeFilter(<span class="string">'container'</span>, {
  height: <span class="number">48</span>,
  barColor: <span class="string">'var(--accent-primary)'</span>,
  onChange: (range) => {
    <span class="key">if</span> (range) {
      console.log(<span class="string">'Selected:'</span>, range.start, <span class="string">'to'</span>, range.end);
    } <span class="key">else</span> {
      console.log(<span class="string">'Selection cleared'</span>);
    }
  }
});
filter.update({
  dates: [<span class="string">'2025-01-01'</span>, <span class="string">'2025-01-02'</span>, ...],
  volumes: [<span class="number">100</span>, <span class="number">150</span>, <span class="number">120</span>, ...]
});</pre>
        </div>
      </div>
    </section>
  </main>
  </div>

  <script>
    // Dropdown functionality
    const dropdowns = document.querySelectorAll('.nav-dropdown');
    dropdowns.forEach((dropdown) => {
      const trigger = dropdown.querySelector('.nav-dropdown-trigger, .avatar-trigger');
      if (trigger) {
        trigger.addEventListener('click', (e) => {
          e.stopPropagation();
          dropdowns.forEach(other => {
            if (other !== dropdown) other.classList.remove('open');
          });
          dropdown.classList.toggle('open');
        });
      }
    });
    
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.nav-dropdown')) {
        dropdowns.forEach(dropdown => dropdown.classList.remove('open'));
      }
    });
  </script>

  <script type="module">
    import { BaseComponent } from './js/components/BaseComponent.js';
    import { Sparkline } from './js/components/Sparkline.js';
    import { NetworkGraph } from './js/components/NetworkGraph.js';
    import { StackedAreaChart } from './js/components/StackedAreaChart.js';
    import { SentimentChart } from './js/components/SentimentChart.js';
    import { VennDiagram } from './js/components/VennDiagram.js';
    import { Timeline } from './js/components/Timeline.js';
    import { TimelineVolumeComposite } from './js/components/TimelineVolumeComposite.js';
    import { MapView } from './js/components/MapView.js';
    import { FactionCards } from './js/components/FactionCards.js';
    import { NarrativeList } from './js/components/NarrativeList.js';
    import { SubNarrativeList } from './js/components/SubNarrativeList.js';
    import { DocumentList } from './js/components/DocumentList.js';
    import { TimeRangeFilter } from './js/components/TimeRangeFilter.js';

    // Demo Data
    const demoFactions = [
      { id: 'f1', name: 'State Actors', color: '#ef4444', memberCount: 1250, sentiment: -0.73 },
      { id: 'f2', name: 'Proxy Networks', color: '#f59e0b', memberCount: 890, sentiment: -0.48 },
      { id: 'f3', name: 'Media Amplifiers', color: '#3b82f6', memberCount: 2100, sentiment: 0.14 },
      { id: 'f4', name: 'Bot Networks', color: '#8b5cf6', memberCount: 15000, sentiment: -0.62 },
      { id: 'f5', name: 'Organic Supporters', color: '#10b981', memberCount: 5600, sentiment: 0.56 }
    ];

    // Initialize Sparklines
    const sparklineUp = new Sparkline(document.getElementById('sparkline-up'), {
      width: 100, height: 30, color: 'var(--accent-success)'
    });
    sparklineUp.update([5, 8, 12, 15, 18, 22, 28, 32, 38]);

    const sparklineDown = new Sparkline(document.getElementById('sparkline-down'), {
      width: 100, height: 30, color: 'var(--accent-danger)'
    });
    sparklineDown.update([40, 35, 32, 28, 22, 18, 15, 12, 8]);

    const sparklineVolatile = new Sparkline(document.getElementById('sparkline-volatile'), {
      width: 100, height: 30, color: 'var(--accent-warning)'
    });
    sparklineVolatile.update([15, 28, 12, 35, 20, 42, 18, 38, 25]);

    const sparklineArea = new Sparkline(document.getElementById('sparkline-area'), {
      width: 100, height: 30, color: 'var(--accent-primary)', showArea: true
    });
    sparklineArea.update([10, 15, 12, 18, 25, 22, 30, 28, 35]);

    // Initialize Network Graph
    const networkGraph = new NetworkGraph(document.getElementById('network-graph'), {
      height: 400,
      onNodeClick: (node) => console.log('Clicked node:', node)
    });
    networkGraph.update({
      nodes: [
        { id: 'p1', label: 'Viktor Petrov', type: 'person' },
        { id: 'p2', label: 'Anna Volkov', type: 'person' },
        { id: 'p3', label: 'Dmitri Kozlov', type: 'person' },
        { id: 'o1', label: 'State Media Corp', type: 'organization' },
        { id: 'o2', label: 'InfoWars Network', type: 'organization' },
        { id: 'o3', label: 'Truth Factory LLC', type: 'organization' },
        { id: 'p4', label: 'Maria Smirnova', type: 'person' },
        { id: 'o4', label: 'Social Analytics', type: 'organization' }
      ],
      links: [
        { source: 'p1', target: 'o1', type: 'person-org' },
        { source: 'p2', target: 'o1', type: 'person-org' },
        { source: 'p2', target: 'o2', type: 'person-org' },
        { source: 'p3', target: 'o2', type: 'person-org' },
        { source: 'o1', target: 'o2', type: 'org-org' },
        { source: 'o2', target: 'o3', type: 'org-org' },
        { source: 'p4', target: 'o3', type: 'person-org' },
        { source: 'p4', target: 'o4', type: 'person-org' },
        { source: 'p1', target: 'p3', type: 'person-person' }
      ]
    });

    // Initialize Stacked Area Chart
    const dates = [];
    const now = new Date();
    for (let i = 30; i >= 0; i--) {
      const d = new Date(now);
      d.setDate(d.getDate() - i);
      dates.push(d.toISOString().split('T')[0]);
    }

    const generateSeries = (base, variance) => {
      return dates.map((_, i) => Math.max(0, base + Math.sin(i * 0.3) * variance + Math.random() * variance * 0.5));
    };

    const stackedAreaChart = new StackedAreaChart(document.getElementById('stacked-area-chart'), {
      height: 280
    });
    stackedAreaChart.update({
      dates,
      series: [
        generateSeries(150, 50),
        generateSeries(100, 40),
        generateSeries(80, 30),
        generateSeries(60, 25)
      ],
      factions: demoFactions.slice(0, 4)
    });

    // Initialize Sentiment Chart
    const sentimentChart = new SentimentChart(document.getElementById('sentiment-chart'), {
      height: 250,
      onFactionClick: (faction) => console.log('Clicked faction:', faction)
    });
    sentimentChart.update({ factions: demoFactions });

    // Initialize Venn Diagram
    const vennDiagram = new VennDiagram(document.getElementById('venn-diagram'), {
      height: 350,
      onFactionClick: (faction) => console.log('Clicked faction:', faction)
    });
    vennDiagram.update({
      sets: [
        { id: 'f1', name: 'State Actors', size: 1000, color: '#ef4444' },
        { id: 'f2', name: 'Proxy Networks', size: 800, color: '#f59e0b' },
        { id: 'f3', name: 'Media Amplifiers', size: 1200, color: '#3b82f6' }
      ],
      overlaps: [
        { factionIds: ['f1', 'f2'], overlapSize: 300 },
        { factionIds: ['f2', 'f3'], overlapSize: 250 },
        { factionIds: ['f1', 'f3'], overlapSize: 150 },
        { factionIds: ['f1', 'f2', 'f3'], overlapSize: 75 }
      ]
    });

    // Initialize Timeline
    const timeline = new Timeline(document.getElementById('timeline-chart'), {
      height: 280,
      onEventClick: (event) => console.log('Clicked event:', event)
    });
    timeline.update({
      events: [
        { id: '1', text: 'Initial article published', date: '2025-01-10T08:00:00Z' },
        { id: '2', text: 'Social media amplification begins', date: '2025-01-12T14:30:00Z' },
        { id: '3', text: 'Bot network detected', date: '2025-01-13T09:15:00Z', parentEventId: '2' },
        { id: '4', text: 'Mainstream media coverage', date: '2025-01-15T11:00:00Z' },
        { id: '5', text: 'Official response issued', date: '2025-01-17T16:45:00Z' },
        { id: '6', text: 'Counter-narrative emerges', date: '2025-01-19T10:30:00Z' }
      ]
    });

    // Initialize Timeline Volume Composite
    // Generate dates for the composite chart (matching the event date range)
    const compositeDates = [];
    for (let i = 0; i <= 12; i++) {
      const d = new Date('2025-01-08');
      d.setDate(d.getDate() + i);
      compositeDates.push(d.toISOString().split('T')[0]);
    }

    // Generate volume data with spikes corresponding to events
    const generateCompositeVolume = (baseVolume, spikeDay, spikeMagnitude) => {
      return compositeDates.map((_, i) => {
        const base = baseVolume + Math.random() * 20;
        // Add spike around specific days
        if (Math.abs(i - spikeDay) <= 1) {
          return base + spikeMagnitude * (1 - Math.abs(i - spikeDay) * 0.4);
        }
        return base;
      });
    };

    // Demo sources for the toggle
    const demoSources = [
      { id: 's1', name: 'X (Twitter)', color: '#000000' },
      { id: 's2', name: 'Facebook', color: '#1877F2' },
      { id: 's3', name: 'TikTok', color: '#00F2EA' },
      { id: 's4', name: 'CNN', color: '#CC0000' }
    ];

    const timelineVolumeComposite = new TimelineVolumeComposite(
      document.getElementById('timeline-volume-composite-chart'), 
      {
        height: 450,
        volumeHeight: 180,
        timelineHeight: 180,
        showViewToggle: true,
        onEventClick: (event) => console.log('Clicked event:', event)
      }
    );
    timelineVolumeComposite.update({
      volumeData: {
        dates: compositeDates,
        series: [
          generateCompositeVolume(50, 2, 120),   // Spike on day 2 (article published)
          generateCompositeVolume(30, 4, 180),   // Spike on day 4 (social media amplification)
          generateCompositeVolume(20, 7, 80),    // Spike on day 7 (mainstream coverage)
        ],
        factions: [
          { id: 'f1', name: 'State Actors', color: '#ef4444' },
          { id: 'f2', name: 'Bot Networks', color: '#8b5cf6' },
          { id: 'f3', name: 'Media Amplifiers', color: '#3b82f6' }
        ]
      },
      sourceData: {
        dates: compositeDates,
        series: [
          generateCompositeVolume(80, 2, 150),   // X - high volume, spike on article
          generateCompositeVolume(60, 4, 100),   // Facebook - spike on amplification
          generateCompositeVolume(40, 4, 200),   // TikTok - big spike on amplification
          generateCompositeVolume(25, 7, 60),    // CNN - spike on mainstream coverage
        ],
        sources: demoSources
      },
      events: [
        { id: '1', text: 'Initial article published', date: '2025-01-10T08:00:00Z' },
        { id: '2', text: 'Social media amplification begins', date: '2025-01-12T14:30:00Z' },
        { id: '3', text: 'Bot network detected', date: '2025-01-13T09:15:00Z', parentEventId: '2' },
        { id: '4', text: 'Mainstream media coverage', date: '2025-01-15T11:00:00Z' },
        { id: '5', text: 'Official response issued', date: '2025-01-17T16:45:00Z' },
        { id: '6', text: 'Counter-narrative emerges', date: '2025-01-19T10:30:00Z' }
      ]
    });

    // Initialize Map View
    const mapView = new MapView(document.getElementById('map-view'), {
      height: 400,
      defaultCenter: [50, 10],
      defaultZoom: 4,
      onMarkerClick: (location) => console.log('Clicked location:', location)
    });
    mapView.update({
      locations: [
        { name: 'Moscow', coordinates: { lat: 55.7558, lng: 37.6173 }, eventCount: 45, isEvent: true },
        { name: 'Berlin', coordinates: { lat: 52.5200, lng: 13.4050 }, narrativeCount: 12 },
        { name: 'Paris', coordinates: { lat: 48.8566, lng: 2.3522 }, narrativeCount: 8 },
        { name: 'Warsaw', coordinates: { lat: 52.2297, lng: 21.0122 }, eventCount: 23, isEvent: true },
        { name: 'Kyiv', coordinates: { lat: 50.4501, lng: 30.5234 }, eventCount: 67, isEvent: true },
        { name: 'London', coordinates: { lat: 51.5074, lng: -0.1278 }, narrativeCount: 15 },
        { name: 'Brussels', coordinates: { lat: 50.8503, lng: 4.3517 }, narrativeCount: 6 }
      ]
    });

    // Initialize Faction Cards
    const factionCards = new FactionCards(document.getElementById('faction-cards-demo'), {
      showCount: true,
      onFactionClick: (faction) => console.log('Clicked faction:', faction)
    });
    factionCards.update({ factions: demoFactions });

    // Initialize Narrative List with expandable sub-narratives
    // Note: In the real app, sub-narratives are loaded via DataService.getSubNarrativesForNarrative()
    // For this demo, we'll show the component without sub-narratives since we don't have DataService mock
    const narrativeList = new NarrativeList(document.getElementById('narrative-list-demo'), {
      maxItems: 5,
      showSentiment: true,
      showStatus: true,
      showSparkline: true,
      showVolume: true,
      showSubNarratives: true,      // Enable expandable themes
      maxSubNarratives: 5,          // Max themes shown when expanded
      defaultShowDescription: false, // Don't show descriptions by default
      onNarrativeClick: (narrative) => console.log('Clicked narrative:', narrative)
    });
    narrativeList.update({
      narratives: [
        {
          id: '1',
          text: 'Election infrastructure vulnerability claims',
          description: 'Coordinated messaging about alleged weaknesses in electronic voting systems.',
          sentiment: -0.68,
          status: 'new',
          createdAt: '2025-01-05T08:00:00Z',
          factionMentions: { f1: { volume: 12500 }, f2: { volume: 8900 } },
          volumeOverTime: dates.slice(-10).map((d, i) => ({
            date: d,
            factionVolumes: { f1: 800 + Math.random() * 400, f2: 500 + Math.random() * 300 }
          }))
        },
        {
          id: '2',
          text: 'Economic instability narratives',
          description: 'Claims of imminent financial collapse targeting specific institutions.',
          sentiment: -0.52,
          status: 'in_progress',
          createdAt: '2025-01-08T14:00:00Z',
          factionMentions: { f1: { volume: 9800 }, f3: { volume: 4200 } },
          volumeOverTime: dates.slice(-10).map((d, i) => ({
            date: d,
            factionVolumes: { f1: 600 + Math.random() * 300, f3: 300 + Math.random() * 200 }
          }))
        },
        {
          id: '3',
          text: 'Health misinformation campaign',
          description: 'False claims about vaccine safety and government health policies.',
          sentiment: -0.77,
          status: 'new',
          createdAt: '2025-01-02T10:00:00Z',
          factionMentions: { f2: { volume: 15600 }, f4: { volume: 22000 } },
          volumeOverTime: dates.slice(-10).map((d, i) => ({
            date: d,
            factionVolumes: { f2: 1200 + Math.random() * 500, f4: 1800 + Math.random() * 600 }
          }))
        },
        {
          id: '4',
          text: 'Immigration crisis exaggeration',
          description: 'Amplified reporting of border incidents with misleading statistics.',
          sentiment: 0.08,
          status: 'in_progress',
          createdAt: '2025-01-10T16:00:00Z',
          factionMentions: { f3: { volume: 6700 } },
          volumeOverTime: dates.slice(-10).map((d, i) => ({
            date: d,
            factionVolumes: { f3: 500 + Math.random() * 250 }
          }))
        },
        {
          id: '5',
          text: 'Climate policy opposition',
          description: 'Coordinated attacks on environmental regulations and green energy initiatives.',
          sentiment: 0.53,
          status: 'new',
          createdAt: '2025-01-12T09:00:00Z',
          factionMentions: { f5: { volume: 4500 } },
          volumeOverTime: dates.slice(-10).map((d, i) => ({
            date: d,
            factionVolumes: { f5: 350 + Math.random() * 150 }
          }))
        }
      ]
    });

    // Initialize Theme List (SubNarrativeList)
    const subNarrativeList = new SubNarrativeList(document.getElementById('subnarrative-list-demo'), {
      maxItems: 5,
      showSparkline: true,
      defaultShowDescription: false,
      onSubNarrativeClick: (theme) => console.log('Clicked theme:', theme)
    });
    subNarrativeList.update({
      subNarratives: [
        {
          id: 'sn1',
          text: 'Voting machines can be hacked remotely',
          description: 'Claims that electronic voting systems are vulnerable to remote attacks.',
          sentiment: -0.72,
          factionMentions: { f1: { volume: 5200 }, f2: { volume: 3100 } },
          volumeOverTime: dates.slice(-10).map((d) => ({
            date: d,
            factionVolumes: { f1: 400 + Math.random() * 200, f2: 200 + Math.random() * 150 }
          }))
        },
        {
          id: 'sn2',
          text: 'Mail-in ballots are easily forged',
          description: 'False claims about the security of mail-in voting processes.',
          sentiment: -0.65,
          factionMentions: { f1: { volume: 4800 }, f4: { volume: 6200 } },
          volumeOverTime: dates.slice(-10).map((d) => ({
            date: d,
            factionVolumes: { f1: 350 + Math.random() * 180, f4: 500 + Math.random() * 250 }
          }))
        },
        {
          id: 'sn3',
          text: 'Ballot counting stopped mysteriously',
          description: 'Misleading narratives about normal counting procedures.',
          sentiment: -0.58,
          factionMentions: { f2: { volume: 3500 } },
          volumeOverTime: dates.slice(-10).map((d) => ({
            date: d,
            factionVolumes: { f2: 280 + Math.random() * 140 }
          }))
        },
        {
          id: 'sn4',
          text: 'Dead people voted in large numbers',
          description: 'Debunked claims about deceased voters.',
          sentiment: -0.81,
          factionMentions: { f1: { volume: 2900 }, f2: { volume: 1800 }, f4: { volume: 4500 } },
          volumeOverTime: dates.slice(-10).map((d) => ({
            date: d,
            factionVolumes: { f1: 220 + Math.random() * 110, f2: 140 + Math.random() * 70, f4: 360 + Math.random() * 180 }
          }))
        },
        {
          id: 'sn5',
          text: 'Foreign interference changed vote totals',
          description: 'Unsubstantiated claims about international vote manipulation.',
          sentiment: -0.69,
          factionMentions: { f1: { volume: 3200 } },
          volumeOverTime: dates.slice(-10).map((d) => ({
            date: d,
            factionVolumes: { f1: 260 + Math.random() * 130 }
          }))
        }
      ]
    });

    // Initialize Document List
    const documentList = new DocumentList(document.getElementById('document-list-demo'), {
      maxItems: 5,
      showExcerpt: true,
      showSource: true,
      showDate: true,
      onDocumentClick: (doc) => console.log('Clicked document:', doc)
    });
    documentList.update({
      documents: [
        {
          id: 'd1',
          title: 'Analysis: Tracking the spread of election misinformation',
          url: 'https://example.com/election-analysis',
          sourceId: 's1',
          publishedDate: '2025-01-15T10:30:00Z',
          excerpt: 'A comprehensive analysis of how false claims about voting systems spread across social media platforms during the election cycle...'
        },
        {
          id: 'd2',
          title: 'State officials debunk viral voting machine claims',
          url: 'https://example.com/officials-debunk',
          sourceId: 's4',
          publishedDate: '2025-01-14T14:15:00Z',
          excerpt: 'Election officials from multiple states have issued statements refuting viral claims about vulnerabilities in voting machines...'
        },
        {
          id: 'd3',
          title: 'Social media platforms struggle with election content',
          url: 'https://example.com/social-media-struggle',
          sourceId: 's2',
          publishedDate: '2025-01-13T09:00:00Z',
          excerpt: 'Major social media companies are facing renewed scrutiny over their handling of election-related misinformation...'
        },
        {
          id: 'd4',
          title: 'Fact-check: No evidence of widespread mail-in ballot fraud',
          url: 'https://example.com/fact-check-mail',
          sourceId: 's4',
          publishedDate: '2025-01-12T16:45:00Z',
          excerpt: 'Claims about fraudulent mail-in ballots continue to circulate despite lack of evidence supporting widespread fraud...'
        },
        {
          id: 'd5',
          title: 'How bot networks amplify election misinformation',
          url: 'https://example.com/bot-networks',
          sourceId: 's1',
          publishedDate: '2025-01-11T11:20:00Z',
          excerpt: 'Research reveals coordinated bot activity amplifying false claims about election integrity across multiple platforms...'
        }
      ]
    });

    // Initialize Time Range Filter
    const timeRangeFilter = new TimeRangeFilter(document.getElementById('time-range-filter-demo'), {
      height: 48,
      margin: { top: 2, right: 8, bottom: 16, left: 8 },
      barColor: 'var(--accent-primary)',
      onChange: (range) => {
        const label = document.getElementById('time-range-label-demo');
        if (range) {
          const formatDate = (d) => d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
          label.textContent = `${formatDate(range.start)} - ${formatDate(range.end)}`;
          console.log('Time range selected:', range);
        } else {
          label.textContent = 'All Time';
          console.log('Time range cleared');
        }
      }
    });
    
    // Generate volume data for the time filter
    const filterVolumes = dates.map(() => Math.floor(50 + Math.random() * 150));
    timeRangeFilter.update({
      dates: dates,
      volumes: filterVolumes
    });

    // Clear button handler
    document.getElementById('clear-time-filter-demo').addEventListener('click', () => {
      timeRangeFilter.clearSelection();
    });

    // Smooth scroll and active state for sidebar navigation
    const navLinks = document.querySelectorAll('.demo-sidebar .nav-link');
    
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) {
          // Remove active class from all links
          navLinks.forEach(l => l.classList.remove('active'));
          // Add active class to clicked link
          link.classList.add('active');
          // Scroll to target
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    // Update active nav link on scroll
    const sections = document.querySelectorAll('.component-section');
    const observerOptions = {
      root: null,
      rootMargin: '-20% 0px -60% 0px',
      threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const id = entry.target.id;
          navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.dataset.target === id) {
              link.classList.add('active');
            }
          });
        }
      });
    }, observerOptions);

    sections.forEach(section => observer.observe(section));

    // Set initial active state
    if (navLinks.length > 0) {
      navLinks[0].classList.add('active');
    }
  </script>
</body>
</html>
